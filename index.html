<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Profiling - mojzis</title>

    <link rel="shortcut icon" href="lib/image/favicon.ico" />
		<meta name="description" content="Invalidating varnish 4">
		<meta name="author" content="Mojzis Stupka">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
		<link rel="stylesheet" href="css/theme/ddd.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
        <footer>
            <div class="branding--logo">
                <span class="logo__image"><img src="lib/image/logo.png" alt="DrupalDeveloperDays Montpellier 2015 logo" height="55px"></span>
                <p class="logo__site-name">#drupaldevdays</p>
            </div>
            <div class="session--info">
                <p class="session__title">Profiling <span class="seperator">&nbsp;/&nbsp;</span></p>
                <p class="session__presenter">mojzis</p>
            </div>
        </footer>
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section class="ddd-intro" data-background="lib/image/background.jpg">
					<h1>Profiling</h1>
					<h2>Mojzis Stupka - @mojzis</h2>
				</section>
				<section data-markdown>
					<script type="text/template">
## About
- mojzis @ CN Group  
[![CN group](img/cn.png)](http://cngroup.dk/)
<aside class="notes">
	Mojzis : team leader & devop
	we hope to grow the drupal section :)
</aside>
					</script>
				</section>
				<section data-markdown data-background="img/old.jpg">
					<script type="text/template">
## disclaimer
- not D8
- check out Luca's [talk](http://montpellier2015.drupaldays.org/sessions/new-tool-measuring-performance-drupal-8)
<aside class="notes">
very interesting talk about profiling options in D8
</aside>
					</script>
				</section>
				<section data-markdown>
					<script type="text/template">
						## Inspiration
						- Fabian @ DrupalCon Amsterdam
						- [Automated performance tracking](https://amsterdam2014.drupal.org/session/automated-performance-tracking)
						- about a nice tool - [xhprof-kit](https://github.com/LionsAd/xhprof-kit)
						<aside class="notes">
kit too much wowen into the patching process, i needed to separate it
							
						</aside>
					</script>
				</section>

				<section>
				<section data-background="img/slow.jpg" data-markdown>
					<script type="text/template">
						## rather slow
					</script>
				</section>
					<section data-background="img/mm.png" data-markdown>
						<script type="text/template">
						</script>
					</section>
				</section>
				
				<section>
				<section data-background="img/many2.jpg" data-markdown>
					<script type="text/template">
						## Too many modules
					</script>
				</section>
					<section data-background="img/mmmod.png" data-markdown>
						<script type="text/template">
						</script>
					</section>
					
				</section>
					<section>
				<section data-background="img/panels.jpg" data-markdown>
					<script type="text/template">
						## Panels ewerywhere
					</script>
				</section>

	<section data-background="img/bubliny.png" data-markdown>
		<script type="text/template">
		</script>
	</section>

</section>
				<section data-background="img/kone.jpg" data-markdown>
					<script type="text/template">
						# Something doesnt belong
					</script>
				</section>
				<section data-background="img/cleanup.jpg" data-markdown>
					<script type="text/template">
						# Cleanup
					</script>
				</section>

				<section data-background="img/fly.jpg" data-markdown>
					<script type="text/template">
						# make it fly
					</script>
				</section>
				
					<section data-markdown>
						<script type="text/template">
							# measure it
							- 
							<aside class="notes">
								serious stuff, birds aside 
								there was a famous quote
							</aside>
						</script>
						<!-- todo: measuring quote ?-->
					</section>
					<section data-background="img/reflect.jpg" data-markdown>
						<script type="text/template">
							## Reflect reality
						</script>
					</section>
					<section data-background="img/compare.jpg" data-markdown>
						<script type="text/template">
							## Compare two runs
						</script>
					</section>
				<section>
					<section data-markdown>
					<script type="text/template">
						## what you need
						- [xhprof](https://github.com/phacility/xhprof)
						- [xhprof cli](https://github.com/msonnabaum/XHProfCLI)
						- [xhprof_ps](https://github.com/cngroupdk/xhprof_ps) module
					</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							## xhprof - install
							- try one of the VMs
							 - [Drupal VM](http://www.drupalvm.com/)
							 - or install it on your own
							<aside class="notes">
								dont follow the howtos until the end though :)
								xhprof doesnt do anything itself - you need to ad it to the scripts youo run
								there is many ways to do it, and its crucial you dont do it the way they tell you :)
							</aside>
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							## xhprof - usage
							- make sure the "display part" is accessible
							 - ie own vhost
							- do read the docs !
							<aside class="notes">
								
								docs are a hidden gem, definitely worst reading
							</aside>
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							## xhprof cli
							- actually hiding commands :)
							- has at least 2
							 - agg
							 - summary
							<aside class="notes">
							</aside>
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							## xhprof_ps
							```
							# download / clone ..
							# check your xhprof config :
							php -r 'print ini_get("xhprof.output_dir");'
							# setup  
							drush vset \
							  xhprof_ps_xhprof_directory \ 
							  "where-is-your-xhprof"``
							# enable  
							drush mm_prof

							```
							<aside class="notes">
								the dir is used to store data from the profiler, apache should have access right to it
								if you use different setup for php-cli (you should), it may have a different value
							</aside>
						</script>
					</section>

				</section>
				<section>
					<section data-markdown>
						<script type="text/template">
							## How to proceed
							- measure 
							- deploy changes
							- measure
							- compare
							<aside class="notes">
							</aside>
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							## Measure
							fetch your comparison page with 2 arguments :
							
							- mm_xp_run=1
							 - prevents other requests from filling your disks
							- run_def=before
							 - give it a name (ie the next one could be "after")
							<aside class="notes">
								one run ahead to make sure caches are filled
								switch off poor mans cron any other stuff that may have weird results
							</aside>
						</script>
					</section>
					<section data-markdown>
						<script type="text/template">
							## Compare
							``xhprof summary /tmp/xhprof/url/``
							
							![result](img/result.png)
							
							<aside class="notes">
								one run ahead to make sure caches are filled
								switch off poor mans cron any other stuff that may have weird results
							</aside>
						</script>
					</section>

				</section>
				<section data-markdown>
					<script type="text/template">
						## Todo
						- drush task to run the wgets
						- improve results directory structure

						<aside class="notes">
							you are wellcome to chime in
						</aside>
					</script>
				</section>
				<section data-markdown>
					<script type="text/template">
						## Future
						- build it into CI process
						- tresholds to raise flags

						<aside class="notes">
							BTW, does anyone here use strider ?  
						</aside>
					</script>
				</section>
				

				<section data-markdown>
					<script type="text/template">
## THANKS :)

_questions wellcome !_

almost no animals were harmed

pics by my kids mostly
						<aside class="notes">
						</aside>
					</script>
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				slideNumber: true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
